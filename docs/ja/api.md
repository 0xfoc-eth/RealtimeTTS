## 設定

### `TextToAudioStream`の初期化パラメータ

`TextToAudioStream`クラスを初期化すると、その動作をカスタマイズするためのさまざまなオプションがあります。 利用可能なパラメータは次のとおりです。

#### `engine` (BaseEngine)
- **タイプ**: BaseEngine
- **必須**: はい テキストから音声への合成を担当する基盤となるエンジン。 オーディオ合成を有効にするには、`BaseEngine` またはそのサブクラスのインスタンスを提供する必要があります。

#### `on_text_stream_start` (呼び出し可能)
- **タイプ**: 呼び出し可能な関数
- **必須**: いいえ このオプションのコールバック関数は、テキストストリームが開始されるとトリガーされます。 必要に応じてセットアップやログに使用してください。

#### `on_text_stream_stop` (呼び出し可能)
- **タイプ**: 呼び出し可能な関数
- **必須**: いいえ このオプションのコールバック関数は、テキストストリームが終了するときにアクティブ化されます。 これをクリーンアップ作業やログ記録に使用できます。

#### `on_audio_stream_start` (呼び出し可能)
- **タイプ**: 呼び出し可能な関数
- **必須**: いいえ このオプションのコールバック関数は、オーディオストリームが開始されると呼び出されます。 UIの更新やイベントログに便利です。

#### `on_audio_stream_stop` (呼び出し可能)
- **タイプ**: 呼び出し可能な関数
- **必須**: いいえ このオプションのコールバック関数は、オーディオストリームが停止したときに呼び出されます。 リソースのクリーンアップや後処理タスクに最適です。

#### `on_character` (callable)
- **タイプ**: 呼び出し可能な関数
- **必須**: いいえ このオプションのコールバック関数は、単一の文字が処理されるときに呼び出されます。

#### `output_device_index` (int)
- **タイプ**: 整数
- **必須**: いいえ 使用する出力デバイスのインデックスを指定します。 誰もデフォルトのデバイスを使用していません。

#### `トークナイザー` (string)
- **タイプ**: 文字列
- **必須**: いいえ
- **デフォルト**: nltk
- **説明**: 文を分割するために使用するトークナイザー (currently "nltk" and "stanza" are supported).

#### `言語` (文字列)
- **タイプ**: 文字列
- **必須**: いいえ 文を分割するために使用する言語。

#### `muted` (bool)
- **タイプ**: Bool
- **必須**: いいえ
- **デフォルト**: 偽
- **説明**: グローバルミュートパラメータ。 Trueの場合、pyAudioストリームは開かれません。 ローカルスピーカー経由の音声再生を無効にします（ファイルに合成したり、音声チャンクを処理したりする場合）し、再生パラメータのミュート設定を上書きします。

#### `level` (int)
- **タイプ**: 整数
- **必須**: いいえ
- **デフォルト**: `logging.WARNING`
- **説明**: 内部ロガーのログレベルを設定します。 これはPythonの組み込み`logging`モジュールの任意の整数定数である可能性があります。

#### 使用例:

```python
engine = YourEngine()  # あなたのエンジンに置き換えてください
stream = TextToAudioStream(
    engine=engine,
    on_text_stream_start=my_text_start_func,
    on_text_stream_stop=my_text_stop_func,
    on_audio_stream_start=my_audio_start_func,
    on_audio_stream_stop=my_audio_stop_func,
    level=logging.INFO
)
```

### 方法

#### `play` と `play_async`

これらのメソッドは、テキストから音声への合成を実行し、オーディオストリームを再生する責任があります。 違いは、`play`がブロッキング関数であるのに対し、`play_async`は別のスレッドで実行されるため、他の操作が進行できることです。

##### パラメータ:

###### `fast_sentence_fragment` (bool)
- **デフォルト**: `True`
- **説明**: `True`に設定すると、このメソッドは速度を優先し、文の断片をより速く生成して再生します。 これはレイテンシが重要なアプリケーションに役立ちます。

###### `fast_sentence_fragment_allsentences` (bool)
- **デフォルト**: `False`
- **説明**: `True`に設定すると、最初の文だけでなくすべての文に対して高速な文断片処理が適用されます。

###### `fast_sentence_fragment_allsentences_multiple` (bool)
- **デフォルト**: `False`
- **説明**: `True`に設定すると、単一の文の断片だけでなく、複数の文の断片を生成することができます。

###### `buffer_threshold_seconds` (float)
- **デフォルト**: `0.0`
- **説明**: バッファリングしきい値の時間を秒単位で指定します。これにより、オーディオ再生のスムーズさと連続性に影響を与えます。

  - **動作方法**: 新しい文を合成する前に、システムはバッファに残っている音声素材が `buffer_threshold_seconds` で指定された時間よりも長いかどうかを確認します。 そうであれば、テキストジェネレーターから別の文を取得し、バッファ内の残りのオーディオによって提供される時間枠内でこの新しい文を取得して合成できると仮定します。 このプロセスにより、テキスト読み上げエンジンはより多くのコンテキストを持つことができ、合成が向上し、ユーザーエクスペリエンスが向上します。

  より高い値を設定することで、事前にバッファリングされたオーディオが増え、再生中の無音やギャップの可能性が減ります。 中断やポーズが発生する場合は、この値を増やすことを検討してください。

###### `minimum_sentence_length` (int)
- **デフォルト**: `10`
- **説明**: 文字列を合成する文と見なすための最小文字数を設定します。 これはテキストチャンクの処理と再生に影響します。

###### `minimum_first_fragment_length` (int)
- **デフォルト**: `10`
- **説明**: 最初の文の断片が出力される前に必要な最小文字数。

###### `log_synthesized_text` (bool)
- **デフォルト**: `False`
- **説明**: 有効にすると、テキストのチャンクが音声に合成される際にログが記録されます。 監査やデバッグに役立ちます。

###### `reset_generated_text` (bool)
- **デフォルト**: `True`
- **説明**: もし真なら、処理の前に生成されたテキストをリセットしてください。

###### `output_wavfile` (str)
- **デフォルト**: `None`
- **説明**: 設定されている場合、指定されたWAVファイルに音声を保存します。

###### `on_sentence_synthesized` (呼び出し可能)
- **デフォルト**: `None`
- **説明**: 単一の文の断片が合成された後に呼び出されるコールバック関数。

###### `before_sentence_synthesized` (呼び出し可能)
- **デフォルト**: `None`
- **説明**: 単一の文の断片が合成される前に呼び出されるコールバック関数。

###### `on_audio_chunk` (呼び出し可能)
- **デフォルト**: `None`
- **説明**: オーディオチャンクが準備できたときに呼び出されるコールバック関数。

###### `tokenizer` (str)
- **デフォルト**: `"nltk"`
- **説明**: 文を分割するために使用するトークナイザー。 現在、「nltk」と「stanza」をサポートしています。

###### `tokenize_sentences` (呼び出し可能)
- **デフォルト**: `None`
- **説明**: 入力テキストから文をトークン化するカスタム関数。 nltkやstanzaに満足できない場合は、自分自身の軽量トークナイザーを提供することができます。 テキストを文字列として受け取り、分割された文を文字列のリストとして返すべきです。

###### `言語` (str)
- **デフォルト**: `"en"`
- **説明**: 文を分割するために使用する言語。

###### `context_size` (int)
- **デフォルト**: `12`
- **説明**: 文境界検出のためにコンテキストを確立するために使用される文字数。 より広い文脈が文の境界を検出する精度を向上させます。

###### `context_size_look_overhead` (int)
- **デフォルト**: `12`
- **説明**: 文の境界を検出する際に前方を見越すための追加のコンテキストサイズ。

###### `ミュート` (bool)
- **デフォルト**: `False`
- **説明**: Trueの場合、ローカルスピーカーを介したオーディオ再生を無効にします。 ファイルに合成したり、音声チャンクを再生せずに処理したりしたいときに便利です。

###### `文の断片区切り` (str)
- **デフォルト**: `".?!;:,\n…)]}。-"`  
- **説明**: 文の区切り文字と見なされる文字列。

###### `force_first_fragment_after_words` (int)
- **デフォルト**: `15`
- **説明**: 最初の文の断片が強制的に出される単語数。


